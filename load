editor.onReady(async () => {
    console.log("[READY] ✅ Editor is fully loaded");

    // 1. Załaduj projekt i assety z backendu
    const project = await window.load_files_callback(); // <- zakładam że to zwraca JSON projektu
    const assets = editor.AssetManager.getAll().models;

    // 2. Stwórz mapę custom: → blob:
    const customToBlobMap = {};
    for (const a of assets) {
      const src = a.get('src');
      const name = a.get('name');
      if (src && name && src.startsWith('blob:')) {
        const custom = `custom:anvil-assets/${name}`;
        customToBlobMap[custom] = src;
      }
    }

    // 3. Zamień w projekcie wszystkie custom: na blob:
    replaceCustomToBlobInAssets(project, customToBlobMap);
    replaceCustomToBlobInPages(project, customToBlobMap);

    // 4. Załaduj projekt do edytora
    await editor.Project.setProjectData(project);

    console.log("[READY] ▶️ Project loaded and src replaced");
  });
