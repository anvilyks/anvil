if (!window.__assetsLoaded) {
  window.setApiFunction().then(result => {
    const assets = editor.AssetManager.getAll().models;

    for (const [file_name, asset] of Object.entries(result)) {
      const alreadyExists = assets.some(a => a.get('name') === file_name);
      
      if (alreadyExists) {
        console.log(`[âš ï¸] Asset "${file_name}" already exists â€” skipping`);
        continue;
      }

      const blobUrl = base64ToBlobUrl(asset.base64, asset.type);
      console.log(`[+] Adding asset "${file_name}" with URL:`, blobUrl);

      editor.AssetManager.add({
        src: blobUrl,
        name: file_name,
        category: "Anvil",
      });
    }

    // ğŸ Ustawiamy flagÄ™ po zakoÅ„czeniu dodawania
    window.__assetsLoaded = true;
  });
} else {
  console.log("âœ… AssetManager already loaded â€“ skipping reload");
}
