function replaceCidWithBlob(components, cidToBlob) {
  for (const comp of components || []) {
    const attrs = comp.attributes || {};

    for (const [key, val] of Object.entries(attrs)) {
      if (typeof val === "string" && val.startsWith("cid:")) {
        const blob = cidToBlob[val];
        if (blob) {
          comp.attributes[key] = blob;
          console.log(`[cid→blob] Replaced ${key}:`, val, "→", blob);
        } else {
          console.warn(`[cid→blob] Missing blob for:`, val);
        }
      }
    }

    if (comp.components) {
      replaceCidWithBlob(comp.components, cidToBlob);
    }
  }
}


const project = await anvil.server.call('load_project');
const cidToBlob = {
  'cid:baner.png': 'blob:https://....', // ← musisz mieć mapę z serwera lub clienta
};
project.pages.forEach(page => replaceCidWithBlob(page.components, cidToBlob));
editor.setProject(project);
